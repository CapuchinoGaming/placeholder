<!DOCTYPE html>

<!--head, links styles and shit-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oracle of Olympus</title>
  <link rel="stylesheet" href="static/style.css">
  <link rel="stylesheet" href="static/animationStyle.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Style+Script&display=swap" rel="stylesheet">
</head>


<body>
  <!--IMAGES-->
  <video autoplay muted loop id="bg-video">
    <source src="static/HPS.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <div class="overlay-image">
    <img src="static/Greek Banner.png" alt="Red stage curtain framing the scene">
  </div>
  <div class="overlay-image2">
    <img src="static/Scroll_1.png" alt="Red stage curtain framing the scene">
  </div>


  <!--BEGINNING PERSONA CHARACTER SELECT-->
  <section id="persona-overlay" class="card-overlay">
    <h1 class="overlay-title">Choose your guiding deity</h1>
    <div class="card-container">
      <button class="persona-card" data-deity="athena">
        <h2>Athena</h2>
        <p>Strategic wisdom, calm mentorship, razor-sharp insight.</p>
      </button>
      <button class="persona-card" data-deity="apollo">
        <h2>Apollo</h2>
        <p>Radiant inspiration, poetic flair, lyrical encouragement.</p>
      </button>
      <button class="persona-card" data-deity="ares">
        <h2>Ares</h2>
        <p>Fiery motivation, bold challenges, relentless drive.</p>
      </button>
    </div>
  </section>

  <!--PROMPT AREA SELECTED PERSON-->
  <main id="main-interface" class="interface hidden">
    <div id="selected-persona" aria-live="polite"></div>
    <div id="response"></div>
    <div class="prompt-area">
      <textarea id="prompt" rows="8" cols="30" placeholder=""></textarea>
      <button id="send">Send</button>
    </div>
  </main>


  <!-- Gemini send and recieve -->
  <script>
    const overlay = document.getElementById("persona-overlay");
    const mainInterface = document.getElementById("main-interface");
    const selectedPersonaBanner = document.getElementById("selected-persona");
    const cards = document.querySelectorAll(".persona-card");


    //SELECTING PERSON AND CARD FADING IN AND OUT
    let selectedPersona = null;

    cards.forEach((card) => {
      card.addEventListener("click", () => {
        selectedPersona = card.dataset.deity;
        const deityName = card.querySelector("h2").textContent;

        selectedPersonaBanner.textContent = `You are now speaking with ${deityName}.`;

        overlay.classList.add("fade-out");
        setTimeout(() => {
          overlay.style.display = "none";
          mainInterface.classList.remove("hidden");
          mainInterface.classList.add("fade-in");
        }, 1000);
      });
    });
    //button
    sendButton.addEventListener("click", async () => {
      const prompt = promptField.value.trim();
      if (!prompt) {
        return;
      }

      if (!selectedPersona) {
        selectedPersonaBanner.textContent = "Select a deity to begin the conversation.";
        return;
      }

      const resp = await fetch("/prompt", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt, persona: selectedPersona })
      });

      const data = await resp.json();

      //THIS IS THE RESULT
      //NEED TO TAKE THIS RESULT, SPLIT INTO ARRAY
      const resultArray = (data.result || "").split(/[.,]\s*/).filter(Boolean);
      console.log("Result array:", resultArray);

      document.dispatchEvent(new CustomEvent("ResultReady", { detail: resultArray }));
    });
  </script>
  
  <div id="output"></div>
  <!-- load JS last so DOM is ready -->
  <script src="static/lineByLine.js" defer></script>

</body>
</html>
